------------
# Ctypes AstroStandard auto-generator
------------

Kerry N. Wood (kerry.wood@jhuapl.edu)

*Summary* : the Python wrappers provided by AS are hand-generated and crappy.  The C-wrappers use function pointers that don't work with `ctypesgen`.  Modify the C-headers to work with Ctypesgen...

## Notes

- the DLL's and .so's are *NOT* provided with this repo (bring your own)
- the header files may be... but they're version-specifc
- for Linux, you'll need to specify `LD_LIBRARY_PATH` *outside* of Python / Jupyter to get the loader to pick it up

## Generating the wrappers entirely

The code for this is in the `builder` directory. 

Points:
    - `include_reformatter.py` will ingest the crappy C-header and reformat them in a way that `ctypesgen` can ingest and reformat
    - `build_ctypes_from_python.py` was built to be platform-agnostic (the previous version was BASH), run this like:
        - `python build_ctypes_from_python.py INCLUDES/AutoGeneratedWrappers/ Lib/`
        - `python build_ctypes_from_python.py ../SGP4_EXT/SampleCode/C/DriverExamples/wrappers/ ../SGP4_EXT/Lib/Linux64/
    - this will create the new python wrappers (and new header files `new_{oldfilename}` 

    **REMEMBER** : you have to set `LD_LIBRARY_PATH` *outside* of the Jupyter session
        - if you have the DLL's / libraries in the local `./Lib` directoy, use `start_jupyter.sh`


## Reusing wrappers by changing the library path
	- you can use `builder\reset_dll_paths.py` to read through previously generated Python harness files and replace the DLL loader info
	- this works even from Linux to Windows (or vice versa)
	- the Python code is implementation-agnostic, so there are no other changes
	- *however*, the libraries are hard-coded in paths... so if you move your setup around, you'll have to reconfigure


## Usage

- on Windows, you can do something like: 
~~~
Get-ChildItem ..\V79\pyincludes\ -Filter *.py | ForEach-Object {
python .\reset_dll_paths.py C:\Users\1368355255E\ASTROSTANDARD_LIBS\ $_.FullName
}
~~~

